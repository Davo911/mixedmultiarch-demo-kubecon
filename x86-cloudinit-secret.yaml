apiVersion: v1
kind: Secret
metadata:
  name: fedora-x86-cloudinit
  namespace: default
type: Opaque
stringData:
  userdata: |
    #cloud-config
    package_update: true
    packages:
      - nginx
    write_files:
      - path: /usr/share/nginx/html/index.html
        owner: root:root
        permissions: '0644'
        encoding: b64
        content: PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KICA8aGVhZD4KICAgIDxtZXRhIGNoYXJzZXQ9InV0Zi04IiAvPgogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xIiAvPgogICAgPHRpdGxlPkhlbGxvIGZyb20geDg2PC90aXRsZT4KICAgIDxsaW5rIHJlbD0icHJlY29ubmVjdCIgaHJlZj0iaHR0cHM6Ly9mb250cy5nb29nbGVhcGlzLmNvbSIgLz4KICAgIDxsaW5rIHJlbD0icHJlY29ubmVjdCIgaHJlZj0iaHR0cHM6Ly9mb250cy5nc3RhdGljLmNvbSIgY3Jvc3NvcmlnaW4gLz4KICAgIDxsaW5rCiAgICAgIGhyZWY9Imh0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vY3NzMj9mYW1pbHk9SUJNK1BsZXgrU2Fuczp3Z2h0QDMwMDs0MDA7NjAwJmRpc3BsYXk9c3dhcCIKICAgICAgcmVsPSJzdHlsZXNoZWV0IgogICAgLz4KICAgIDxzdHlsZT4KICAgICAgOnJvb3QgewogICAgICAgIGNvbG9yLXNjaGVtZTogbGlnaHQ7CiAgICAgIH0KCiAgICAgICogewogICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgICAgIH0KCiAgICAgIGJvZHkgewogICAgICAgIG1hcmdpbjogMDsKICAgICAgICBtaW4taGVpZ2h0OiAxMDB2aDsKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgcGFkZGluZzogM3JlbSAxLjVyZW07CiAgICAgICAgZm9udC1mYW1pbHk6ICdJQk0gUGxleCBTYW5zJywgLWFwcGxlLXN5c3RlbSwgQmxpbmtNYWNTeXN0ZW1Gb250LCAnU2Vnb2UgVUknLCBzYW5zLXNlcmlmOwogICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxNjBkZWcsICNmZmY2ZjggMCUsICNmZmUwZTcgNDUlLCAjZmZkMWRhIDEwMCUpOwogICAgICAgIGNvbG9yOiAjNGExMDFjOwogICAgICB9CgogICAgICAuY29udGVudCB7CiAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgIGdhcDogMS43NXJlbTsKICAgICAgICB3aWR0aDogbWluKDU0MHB4LCAxMDAlKTsKICAgICAgfQoKICAgICAgaDEgewogICAgICAgIG1hcmdpbjogMDsKICAgICAgICBmb250LXNpemU6IGNsYW1wKDIuNXJlbSwgNnZ3LCAzLjVyZW0pOwogICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgICAgbGV0dGVyLXNwYWNpbmc6IDAuMDFlbTsKICAgICAgfQoKICAgICAgLmhlcm8taW1hZ2UgewogICAgICAgIHdpZHRoOiBtaW4oMzYwcHgsIDc1dncpOwogICAgICAgIGJvcmRlci1yYWRpdXM6IDEuMjVyZW07CiAgICAgICAgZGlzcGxheTogYmxvY2s7CiAgICAgIH0KCiAgICAgIC5ub3RlIHsKICAgICAgICBmb250LXNpemU6IDAuOTVyZW07CiAgICAgICAgbGV0dGVyLXNwYWNpbmc6IDAuMDhlbTsKICAgICAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgICAgIGNvbG9yOiByZ2JhKDc0LCAxNiwgMjgsIDAuNik7CiAgICAgIH0KCiAgICAgIC5yZXN1bHQgewogICAgICAgIGZvbnQtc2l6ZTogMS4xcmVtOwogICAgICAgIGZvbnQtd2VpZ2h0OiA1MDA7CiAgICAgICAgY29sb3I6IHJnYmEoNzQsIDE2LCAyOCwgMC44KTsKICAgICAgICBtaW4taGVpZ2h0OiAxLjVlbTsKICAgICAgfQoKICAgICAgLmxvYWRpbmcgewogICAgICAgIGRpc3BsYXk6IGlubGluZS1mbGV4OwogICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgZ2FwOiAwLjQ1cmVtOwogICAgICAgIGZvbnQtc2l6ZTogMXJlbTsKICAgICAgICBjb2xvcjogcmdiYSg3NCwgMTYsIDI4LCAwLjcpOwogICAgICB9CgogICAgICAubG9hZGluZyBzcGFuIHsKICAgICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICAgICAgd2lkdGg6IDAuNHJlbTsKICAgICAgICBoZWlnaHQ6IDAuNHJlbTsKICAgICAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAgICAgYmFja2dyb3VuZDogcmdiYSg3NCwgMTYsIDI4LCAwLjQ1KTsKICAgICAgICBhbmltYXRpb246IGJvdW5jZSAxcyBpbmZpbml0ZSBlYXNlLWluLW91dDsKICAgICAgfQoKICAgICAgLmxvYWRpbmcgc3BhbjpudGgtY2hpbGQoMikgewogICAgICAgIGFuaW1hdGlvbi1kZWxheTogMC4xNXM7CiAgICAgIH0KCiAgICAgIC5sb2FkaW5nIHNwYW46bnRoLWNoaWxkKDMpIHsKICAgICAgICBhbmltYXRpb24tZGVsYXk6IDAuM3M7CiAgICAgIH0KCiAgICAgIEBrZXlmcmFtZXMgYm91bmNlIHsKICAgICAgICAwJSwKICAgICAgICA4MCUsCiAgICAgICAgMTAwJSB7CiAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMCk7CiAgICAgICAgICBvcGFjaXR5OiAwLjY7CiAgICAgICAgfQogICAgICAgIDQwJSB7CiAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTZweCk7CiAgICAgICAgICBvcGFjaXR5OiAxOwogICAgICAgIH0KICAgICAgfQogICAgPC9zdHlsZT4KICA8L2hlYWQ+CiAgPGJvZHk+CiAgICA8ZGl2IGNsYXNzPSJjb250ZW50Ij4KICAgICAgPGltZwogICAgICAgIHNyYz0iaHR0cHM6Ly9kYXZvOTExLmdpdGh1Yi5pby94ODZTZXJ2ZXIucG5nIgogICAgICAgIGFsdD0iU3R5bGl6ZWQgeDg2IHNlcnZlciBpbGx1c3RyYXRpb24iCiAgICAgICAgY2xhc3M9Imhlcm8taW1hZ2UiCiAgICAgIC8+CiAgICAgIDxwIGNsYXNzPSJub3RlIj5TZXJ2ZWQgZnJvbSB4ODYgTm9kZTogY29tcHV0ZS0xLm9jcDYudGVzdC5tYWluejwvcD4KICAgICAgPGltZwogICAgICAgIHNyYz0iaHR0cHM6Ly9wbGFjZWtpdHRlbnMuY29tLzMwMC8yMDAiCiAgICAgICAgYWx0PSJBIGN1cmlvdXMgY2F0IGxvb2tpbmcgYXQgdGhlIGNhbWVyYSIKICAgICAgICB3aWR0aD0iMzAwIgogICAgICAgIGhlaWdodD0iMjAwIgogICAgICAgIHN0eWxlPSJib3JkZXItcmFkaXVzOiAxcmVtOyBib3gtc2hhZG93OiAwIDEycHggMzBweCByZ2JhKDc0LCAxNiwgMjgsIDAuMTgpOyIKICAgICAgLz4KICAgICAgPHAgaWQ9InJlc3VsdCIgY2xhc3M9InJlc3VsdCI+CiAgICAgICAgPHNwYW4gY2xhc3M9ImxvYWRpbmciIGFyaWEtbGl2ZT0icG9saXRlIiBhcmlhLWJ1c3k9InRydWUiPgogICAgICAgICAgUnVubmluZyBpbmZlcmVuY2UKICAgICAgICAgIDxzcGFuPjwvc3Bhbj4KICAgICAgICAgIDxzcGFuPjwvc3Bhbj4KICAgICAgICAgIDxzcGFuPjwvc3Bhbj4KICAgICAgICA8L3NwYW4+CiAgICAgIDwvcD4KICAgIDwvZGl2PgogICAgPHNjcmlwdD4KICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7CiAgICAgICAgY29uc3QgcmVzdWx0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0Jyk7CgogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgcmVzdWx0RWwuaW5uZXJIVE1MID0gIkl0J3MgYSBjYXQhIChDb25maWRlbmNlOiA5OCUpIjsKICAgICAgICAgIHJlc3VsdEVsLnNldEF0dHJpYnV0ZSgnYXJpYS1saXZlJywgJ3BvbGl0ZScpOwogICAgICAgIH0sIDIwMDApOwogICAgICB9KTsKICAgIDwvc2NyaXB0PgogIDwvYm9keT4KPC9odG1sPgo=
    runcmd:
      - [bash, -c, "systemctl disable --now firewalld || true"]
      - [systemctl, enable, --now, nginx]
